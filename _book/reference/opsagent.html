<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>OpsAgent | Book</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="MadeiraCloud">
        <meta name="description" content="Book generated using GitBook">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../reference/api.html" />
        
        
        <link rel="prev" href="../reference/reserved_keyword.html" />
        

        <meta property="og:title" content="OpsAgent | Book">
        <meta property="og:site_name" content="Book">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/MadeiraCloud">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

        
        <link rel="stylesheet" href="../gitbook/style.css">
        
        
    </head>
    <body>
        
<div class="book" data-github="MadeiraCloud/book" data-level="8.7" data-basepath=".." data-revision="1424062841970">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="https://github.com/MadeiraCloud/book" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    <a href="https://github.com/MadeiraCloud/book/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/MadeiraCloud/book/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>


    <!-- Title -->
    <h1><a href="../" >Book</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        <li>
            <a href="https://github.com/MadeiraCloud" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/MadeiraCloud/book/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/MadeiraCloud/book/edit/master/reference/opsagent.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="index.html">
                
                <a href="../index.html">
                    <i class="fa fa-check"></i> <b>1)</b> Introduction
                </a>
                
                
            </li>
        
            <li  data-level="2" data-path="getting_started/README.html">
                
                <a href="../getting_started/README.html">
                    <i class="fa fa-check"></i> <b>2)</b> Getting Started
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="getting_started/how_it_works.html">
                            
                            <a href="../getting_started/how_it_works.html">
                                <i class="fa fa-check"></i> <b>2.1)</b> How it works
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="getting_started/setup.html">
                            
                            <a href="../getting_started/setup.html">
                                <i class="fa fa-check"></i> <b>2.2)</b> Setup
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="getting_started/create_your_first_app.html">
                            
                            <a href="../getting_started/create_your_first_app.html">
                                <i class="fa fa-check"></i> <b>2.3)</b> Create Your First App
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3" data-path="stack/README.html">
                
                <a href="../stack/README.html">
                    <i class="fa fa-check"></i> <b>3)</b> Managing Stack
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" data-path="stack/instance_state_switch.html">
                            
                            <a href="../stack/instance_state_switch.html">
                                <i class="fa fa-check"></i> <b>3.1)</b> Instance State Switch
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.2" data-path="stack/validate_stack.html">
                            
                            <a href="../stack/validate_stack.html">
                                <i class="fa fa-check"></i> <b>3.2)</b> Validate Stack Design
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.3" data-path="stack/cost_estimation.html">
                            
                            <a href="../stack/cost_estimation.html">
                                <i class="fa fa-check"></i> <b>3.3)</b> Cost Estimation
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.4" data-path="stack/clone_resource.html">
                            
                            <a href="../stack/clone_resource.html">
                                <i class="fa fa-check"></i> <b>3.4)</b> Clone Resource
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.5" data-path="stack/import_existing_stack.html">
                            
                            <a href="../stack/import_existing_stack.html">
                                <i class="fa fa-check"></i> <b>3.5)</b> Import Existing Stack
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.6" data-path="stack/import_cloudformation_template.html">
                            
                            <a href="../stack/import_cloudformation_template.html">
                                <i class="fa fa-check"></i> <b>3.6)</b> Import CloudFormation template
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="4" data-path="app/README.html">
                
                <a href="../app/README.html">
                    <i class="fa fa-check"></i> <b>4)</b> Managing App
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1" data-path="app/edit.html">
                            
                            <a href="../app/edit.html">
                                <i class="fa fa-check"></i> <b>4.1)</b> Edit Running App
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.2" data-path="app/import.html">
                            
                            <a href="../app/import.html">
                                <i class="fa fa-check"></i> <b>4.2)</b> Import Existing VPC
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.3" data-path="app/track_app_changes.html">
                            
                            <a href="../app/track_app_changes.html">
                                <i class="fa fa-check"></i> <b>4.3)</b> Track App Changes
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.4" data-path="app/save_app_to_stack.html">
                            
                            <a href="../app/save_app_to_stack.html">
                                <i class="fa fa-check"></i> <b>4.4)</b> Save App to Stack
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.5" data-path="app/reload_states.html">
                            
                            <a href="../app/reload_states.html">
                                <i class="fa fa-check"></i> <b>4.5)</b> Reload States
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.6" data-path="app/forget_app.html">
                            
                            <a href="../app/forget_app.html">
                                <i class="fa fa-check"></i> <b>4.6)</b> Forget App
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="5" data-path="workspace/README.html">
                
                <a href="../workspace/README.html">
                    <i class="fa fa-check"></i> <b>5)</b> Managing Workspace
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="5.1" data-path="workspace/create_new_workspace.html">
                            
                            <a href="../workspace/create_new_workspace.html">
                                <i class="fa fa-check"></i> <b>5.1)</b> Create new workspace
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.2" data-path="workspace/team_management.html">
                            
                            <a href="../workspace/team_management.html">
                                <i class="fa fa-check"></i> <b>5.2)</b> Team Management
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.3" data-path="workspace/cloud_credential.html">
                            
                            <a href="../workspace/cloud_credential.html">
                                <i class="fa fa-check"></i> <b>5.3)</b> Cloud Credential
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.4" data-path="workspace/billing_&amp;_usage.html">
                            
                            <a href="../workspace/billing_&amp;_usage.html">
                                <i class="fa fa-check"></i> <b>5.4)</b> Billing &amp; Usage
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.5" data-path="workspace/api_token.html">
                            
                            <a href="../workspace/api_token.html">
                                <i class="fa fa-check"></i> <b>5.5)</b> API Token
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.6" data-path="workspace/delete_a_workspace.html">
                            
                            <a href="../workspace/delete_a_workspace.html">
                                <i class="fa fa-check"></i> <b>5.6)</b> Delete a workspace
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="6" data-path="aws/README.html">
                
                <a href="../aws/README.html">
                    <i class="fa fa-check"></i> <b>6)</b> Amazon Web Services
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="6.1" data-path="aws/shared_resource.html">
                            
                            <a href="../aws/shared_resource.html">
                                <i class="fa fa-check"></i> <b>6.1)</b> Shared Resource
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.2" data-path="aws/ec2/ec2.html">
                            
                            <a href="../aws/ec2/ec2.html">
                                <i class="fa fa-check"></i> <b>6.2)</b> EC2
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.3" data-path="aws/vpc/vpc.html">
                            
                            <a href="../aws/vpc/vpc.html">
                                <i class="fa fa-check"></i> <b>6.3)</b> VPC
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.4" data-path="aws/elb/elb.html">
                            
                            <a href="../aws/elb/elb.html">
                                <i class="fa fa-check"></i> <b>6.4)</b> ELB
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.5" data-path="aws/autoscaling/autoscaling.html">
                            
                            <a href="../aws/autoscaling/autoscaling.html">
                                <i class="fa fa-check"></i> <b>6.5)</b> AutoScaling
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.6" data-path="aws/rds/rds.html">
                            
                            <a href="../aws/rds/rds.html">
                                <i class="fa fa-check"></i> <b>6.6)</b> RDS
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.7" data-path="aws/example/README.html">
                            
                            <a href="../aws/example/README.html">
                                <i class="fa fa-check"></i> <b>6.7)</b> Example
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="7" data-path="state/README.html">
                
                <a href="../state/README.html">
                    <i class="fa fa-check"></i> <b>7)</b> State Modules
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="7.1" data-path="state/common/common.html">
                            
                            <a href="../state/common/common.html">
                                <i class="fa fa-check"></i> <b>7.1)</b> Common
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.2" data-path="state/linux/linux.html">
                            
                            <a href="../state/linux/linux.html">
                                <i class="fa fa-check"></i> <b>7.2)</b> Linux
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.3" data-path="state/meta/meta.html">
                            
                            <a href="../state/meta/meta.html">
                                <i class="fa fa-check"></i> <b>7.3)</b> Meta
                            </a>
                            
                        </li>
                    
                        <li  data-level="7.4" data-path="state/windows/windows.html">
                            
                            <a href="../state/windows/windows.html">
                                <i class="fa fa-check"></i> <b>7.4)</b> Windows
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="8" data-path="reference/README.html">
                
                <a href="../reference/README.html">
                    <i class="fa fa-check"></i> <b>8)</b> Reference
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="8.1" data-path="reference/faq.html">
                            
                            <a href="../reference/faq.html">
                                <i class="fa fa-check"></i> <b>8.1)</b> FAQ
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.2" data-path="reference/terms.html">
                            
                            <a href="../reference/terms.html">
                                <i class="fa fa-check"></i> <b>8.2)</b> Terms
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.3" data-path="reference/cli.html">
                            
                            <a href="../reference/cli.html">
                                <i class="fa fa-check"></i> <b>8.3)</b> CLI
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.4" data-path="reference/ide_shortcut.html">
                            
                            <a href="../reference/ide_shortcut.html">
                                <i class="fa fa-check"></i> <b>8.4)</b> IDE Shortcut
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.5" data-path="reference/link_syntax.html">
                            
                            <a href="../reference/link_syntax.html">
                                <i class="fa fa-check"></i> <b>8.5)</b> Link
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.6" data-path="reference/reserved_keyword.html">
                            
                            <a href="../reference/reserved_keyword.html">
                                <i class="fa fa-check"></i> <b>8.6)</b> Reserved Keyword
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.7" data-path="reference/opsagent.html">
                            
                            <a href="../reference/opsagent.html">
                                <i class="fa fa-check"></i> <b>8.7)</b> OpsAgent
                            </a>
                            
                        </li>
                    
                        <li  data-level="8.8" data-path="reference/api.html">
                            
                            <a href="../reference/api.html">
                                <i class="fa fa-check"></i> <b>8.8)</b> API
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
    </ul>
</div>

    <div class="book-body" tabindex="-1">
        <div class="body-inner">
            <div class="page-wrapper">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 97.87234042553192%;min-width: 95.74468085106383%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../getting_started/README.html" title="Getting Started" class="chapter done new-chapter" data-progress="2" style="left: 2.127659574468085%;"></a>
    
        <a href="../getting_started/how_it_works.html" title="How it works" class="chapter done " data-progress="2.1" style="left: 4.25531914893617%;"></a>
    
        <a href="../getting_started/setup.html" title="Setup" class="chapter done " data-progress="2.2" style="left: 6.382978723404255%;"></a>
    
        <a href="../getting_started/create_your_first_app.html" title="Create Your First App" class="chapter done " data-progress="2.3" style="left: 8.51063829787234%;"></a>
    
        <a href="../stack/README.html" title="Managing Stack" class="chapter done new-chapter" data-progress="3" style="left: 10.638297872340425%;"></a>
    
        <a href="../stack/instance_state_switch.html" title="Instance State Switch" class="chapter done " data-progress="3.1" style="left: 12.76595744680851%;"></a>
    
        <a href="../stack/validate_stack.html" title="Validate Stack Design" class="chapter done " data-progress="3.2" style="left: 14.893617021276595%;"></a>
    
        <a href="../stack/cost_estimation.html" title="Cost Estimation" class="chapter done " data-progress="3.3" style="left: 17.02127659574468%;"></a>
    
        <a href="../stack/clone_resource.html" title="Clone Resource" class="chapter done " data-progress="3.4" style="left: 19.148936170212767%;"></a>
    
        <a href="../stack/import_existing_stack.html" title="Import Existing Stack" class="chapter done " data-progress="3.5" style="left: 21.27659574468085%;"></a>
    
        <a href="../stack/import_cloudformation_template.html" title="Import CloudFormation template" class="chapter done " data-progress="3.6" style="left: 23.404255319148938%;"></a>
    
        <a href="../app/README.html" title="Managing App" class="chapter done new-chapter" data-progress="4" style="left: 25.53191489361702%;"></a>
    
        <a href="../app/edit.html" title="Edit Running App" class="chapter done " data-progress="4.1" style="left: 27.659574468085108%;"></a>
    
        <a href="../app/import.html" title="Import Existing VPC" class="chapter done " data-progress="4.2" style="left: 29.78723404255319%;"></a>
    
        <a href="../app/track_app_changes.html" title="Track App Changes" class="chapter done " data-progress="4.3" style="left: 31.914893617021278%;"></a>
    
        <a href="../app/save_app_to_stack.html" title="Save App to Stack" class="chapter done " data-progress="4.4" style="left: 34.04255319148936%;"></a>
    
        <a href="../app/reload_states.html" title="Reload States" class="chapter done " data-progress="4.5" style="left: 36.170212765957444%;"></a>
    
        <a href="../app/forget_app.html" title="Forget App" class="chapter done " data-progress="4.6" style="left: 38.297872340425535%;"></a>
    
        <a href="../workspace/README.html" title="Managing Workspace" class="chapter done new-chapter" data-progress="5" style="left: 40.42553191489362%;"></a>
    
        <a href="../workspace/create_new_workspace.html" title="Create new workspace" class="chapter done " data-progress="5.1" style="left: 42.5531914893617%;"></a>
    
        <a href="../workspace/team_management.html" title="Team Management" class="chapter done " data-progress="5.2" style="left: 44.680851063829785%;"></a>
    
        <a href="../workspace/cloud_credential.html" title="Cloud Credential" class="chapter done " data-progress="5.3" style="left: 46.808510638297875%;"></a>
    
        <a href="../workspace/billing_&amp;_usage.html" title="Billing &amp; Usage" class="chapter done " data-progress="5.4" style="left: 48.93617021276596%;"></a>
    
        <a href="../workspace/api_token.html" title="API Token" class="chapter done " data-progress="5.5" style="left: 51.06382978723404%;"></a>
    
        <a href="../workspace/delete_a_workspace.html" title="Delete a workspace" class="chapter done " data-progress="5.6" style="left: 53.191489361702125%;"></a>
    
        <a href="../aws/README.html" title="Amazon Web Services" class="chapter done new-chapter" data-progress="6" style="left: 55.319148936170215%;"></a>
    
        <a href="../aws/shared_resource.html" title="Shared Resource" class="chapter done " data-progress="6.1" style="left: 57.4468085106383%;"></a>
    
        <a href="../aws/ec2/ec2.html" title="EC2" class="chapter done " data-progress="6.2" style="left: 59.57446808510638%;"></a>
    
        <a href="../aws/vpc/vpc.html" title="VPC" class="chapter done " data-progress="6.3" style="left: 61.702127659574465%;"></a>
    
        <a href="../aws/elb/elb.html" title="ELB" class="chapter done " data-progress="6.4" style="left: 63.829787234042556%;"></a>
    
        <a href="../aws/autoscaling/autoscaling.html" title="AutoScaling" class="chapter done " data-progress="6.5" style="left: 65.95744680851064%;"></a>
    
        <a href="../aws/rds/rds.html" title="RDS" class="chapter done " data-progress="6.6" style="left: 68.08510638297872%;"></a>
    
        <a href="../aws/example/README.html" title="Example" class="chapter done " data-progress="6.7" style="left: 70.2127659574468%;"></a>
    
        <a href="../state/README.html" title="State Modules" class="chapter done new-chapter" data-progress="7" style="left: 72.34042553191489%;"></a>
    
        <a href="../state/common/common.html" title="Common" class="chapter done " data-progress="7.1" style="left: 74.46808510638297%;"></a>
    
        <a href="../state/linux/linux.html" title="Linux" class="chapter done " data-progress="7.2" style="left: 76.59574468085107%;"></a>
    
        <a href="../state/meta/meta.html" title="Meta" class="chapter done " data-progress="7.3" style="left: 78.72340425531915%;"></a>
    
        <a href="../state/windows/windows.html" title="Windows" class="chapter done " data-progress="7.4" style="left: 80.85106382978724%;"></a>
    
        <a href="../reference/README.html" title="Reference" class="chapter done new-chapter" data-progress="8" style="left: 82.97872340425532%;"></a>
    
        <a href="../reference/faq.html" title="FAQ" class="chapter done " data-progress="8.1" style="left: 85.1063829787234%;"></a>
    
        <a href="../reference/terms.html" title="Terms" class="chapter done " data-progress="8.2" style="left: 87.23404255319149%;"></a>
    
        <a href="../reference/cli.html" title="CLI" class="chapter done " data-progress="8.3" style="left: 89.36170212765957%;"></a>
    
        <a href="../reference/ide_shortcut.html" title="IDE Shortcut" class="chapter done " data-progress="8.4" style="left: 91.48936170212765%;"></a>
    
        <a href="../reference/link_syntax.html" title="Link" class="chapter done " data-progress="8.5" style="left: 93.61702127659575%;"></a>
    
        <a href="../reference/reserved_keyword.html" title="Reserved Keyword" class="chapter done " data-progress="8.6" style="left: 95.74468085106383%;"></a>
    
        <a href="../reference/opsagent.html" title="OpsAgent" class="chapter done " data-progress="8.7" style="left: 97.87234042553192%;"></a>
    
        <a href="../reference/api.html" title="API" class="chapter  " data-progress="8.8" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_27">
                    
                        <h1 id="opsagent">OpsAgent</h1>
<h3 id="opsagent">OpsAgent</h3>
<p>In order to apply the instance states, VisualOps requires an agent, named <code>opsagent</code>, to be deployed on the instances. This agent maintains a WebSocket connection with our endpoint to send and receive states. Compared with other DevOps agent&#39;s polling mechanisms, WebSocket allows the states to be pushed to the agent immediately, making the execution much faster. Once receiving the states, <code>opsagent</code> will immediately begin to apply them repeatedly, until you issue a new state.</p>
<p><code>opsagent</code> uses a modified version of <a href="http://www.saltstack.com/" target="_blank">Salt</a> to do the actual configuration work. However there is no need for you to learn Salt itself, nor write in the Salt format. We have built <a href="refrence/mod.html">a thin wrapper</a> on top of Salt to make defining an instance state incredibly simple.</p>
<p><code>opsagent</code> and the modified Salt version are both open-sourced and can be found at our Github repo: <a href="https://github.com/MadeiraCloud/opsagent" target="_blank">[1]</a> and <a href="https://github.com/MadeiraCloud/salt" target="_blank">[2]</a>.</p>
<p>In order for VisualOps to work, <a href="https://github.com/MadeiraCloud/OpsAgent" target="_blank">opsagent</a> will be installed on your instances. The sources of opsagent are open, and can be found <a href="https://github.com/MadeiraCloud/salt" target="_blank">here</a></p>
<h2 id="instance-userdata">Instance Userdata</h2>
<p>In order to initialize opsagent, VisualOps uses the <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AESDG-chapter-instancedata.html" target="_blank">instance userdata</a> to start the bootstrap sequence, generating a root cron script</p>
<h2 id="location-virtualenv">Location &amp; Virtualenv</h2>
<blockquote>
<p>CAUTION: please take care to not manually edit any of the files located under these emplacements</p>
</blockquote>
<p><code>opsagent</code> will be setup in the following directories on your instances:</p>
<blockquote>
<ul>
<li><code>/opt/visualops</code> source code and virtual environment</li>
<li><code>/var/lib/visualops</code> generated files and scripts</li>
<li><code>/var/log/visualops</code> log files</li>
<li><code>/etc/opsagent.conf</code> generated config file</li>
</ul>
</blockquote>
<p>Note: opsagent and all dependencies are deployed in a <code>virtualenv</code>, to prevent any impact to the hosting instance</p>
<h2 id="manual-setup">Manual Setup</h2>
<p>In some cases, the agent can not bootstrap automatically (i.e some custom AMIs). In this case, you will have to bootstrap the agent manually</p>
<p>If you want to bootstrap the agent manually, simply ssh to the instance and run the following command (as root):</p>
<p># <code>curl -sSL http://169.254.169.254/latest/user-data/ | bash</code></p>
<h2 id="salt">Salt</h2>
<p>Under the hood, opsagent uses a modified version of Salt to perform the actual state execution. By default, opsagent will clone <a href="https://github.com/MadeiraCloud/salt" target="_blank">our fork of Salt</a> to <code>/opt/visualops/bootstrap/salt</code></p>
<h2 id="state-execution">State Execution</h2>
<p>Opsagent loops to execute the state list (a.k.a <code>Recipe</code>) sent from VisualOps (a.k.a <code>Round</code>), to ensure the instance runs as predefined. Like other DevOps tools (Puppet, Chef, Ansible), <a href="http://en.wikipedia.org/wiki/Idempotence" target="_blank">Idempotent</a> is required</p>
<p>Luckily, this is already solved in Salt</p>
<p>Within a <code>round</code>, opsagent goes through the <code>recipe</code> sequentially, in the same order as the list is shown in the IDE, to execute the states one by one:</p>
<ul>
<li>If a state execution fails, opsagent will restart from the beginning of the round</li>
<li>If the state still fails, opsagent will cease the <code>round</code>, wait and retry the <code>recipe</code> from the beginning</li>
<li>For the case of <code>comment #</code> state, opsagent simply skips over</li>
<li>For the case of <code>wait</code> state, opsagent will wait for the <code>DONE</code> message from VisualOps to proceed</li>
<li>Whenever a new <code>recipe</code> is received, the current <code>round</code> will immediately cease, and a new <code>round</code> will start</li>
<li>When opsagent receives the <code>UPGRADE</code> message, it will continue the current <code>round</code> and perform the upgrade until the <code>round</code> finishes</li>
</ul>
<h2 id="upgrade">Upgrade</h2>
<p>Opsagent is directly deployed from the tarballs present in the public S3 bucket (<a href="https://s3.amazonaws.com/opsagent/x.y/opsagent.tgz" target="_blank">https://s3.amazonaws.com/opsagent/x.y/opsagent.tgz</a> - where x.y is the version number)</p>
<p> The tarball is maintained and updated by <a href="http://www.visualops.io" target="_blank">VisualOps</a> team for each release</p>
<p> If a new version is available:</p>
<blockquote>
<ul>
<li>when you try to launch a new app, the latest version of opsagent will be automatically deployed in the app&#39;s instances</li>
<li>when you open an app in the IDE, a notification will show up, you have the option to choose whether to upgrade the opsagent in the app, and select the version you want to use</li>
<li>if you decide to upgrade, the process will be taken immediately to the running instance; for those stopped instances, the upgrade will be completed as soon as the instances boot</li>
</ul>
</blockquote>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../reference/reserved_keyword.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../reference/api.html" class="navigation navigation-next"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../gitbook/app.js"></script>
        
    </body>
</html>
